# Repository Guidelines

## Project Structure & Module Organization
- `src/` TypeScript source (ESM). Key modules: `index.ts` (server entry), `main.ts` (CLI bootstrap), `cli.ts` (commands), `n8n-client.ts` (n8n API), `operations.ts` (workflow ops), `logger.ts`, `types.ts`.
- `src/__tests__/` Jest tests (`*.test.ts`).
- `dist/` build output (generated by `tsc`).
- `examples/` MCP client configs and sample workflows. `scripts/smoke/` post-publish smoke checks.
- `docs/`, `.github/` workflows, `coverage/` (generated).

Note: Use ESM-style relative imports with `.js` extension in TS (e.g., `import x from './types.js'`).

## Build, Test, and Development Commands
- `npm run dev` — TypeScript watch compile.
- `npm run build` — Compile to `dist/` via `tsc`.
- `npm start` — Run MCP server (`node dist/index.js`).
- `npm run cli ...` — Run built CLI (`node dist/cli.js`). Example: `npm run cli list`.
- `npm test` / `npm run test:watch` / `npm run test:coverage` — Jest tests and coverage.
- `npm run lint` — Type-check only (`tsc --noEmit`).

## Coding Style & Naming Conventions
- Language: TypeScript (ESM, Node >= 18). Two-space indentation; follow existing patterns.
- Filenames: kebab-case for multiword modules (e.g., `n8n-client.ts`). Tests: `<name>.test.ts` in `src/__tests__/`.
- Imports: keep relative imports with `.js` extension to match ESM output.
- No ESLint/Prettier configured; keep code consistent with neighboring files.

## Testing Guidelines
- Framework: Jest (`ts-jest` ESM preset). Tests live in `src/__tests__/`.
- Coverage: thresholds enforced in `jest.config.js`; avoid regressions.
- Run: `npm test` locally; add/adjust tests for behavior changes.

## Commit & Pull Request Guidelines
- Use Conventional Commits (e.g., `feat:`, `fix:`, `docs:`, `ci:`, `test:`). Example: `feat(cli): add variables subcommands`.
- PRs should include: clear description, linked issues (`Fixes #123`), tests, and doc updates (`README.md`, `examples/`) when applicable.
- Keep changes focused; align with existing module boundaries and naming.

## Security & Configuration Tips
- Do not commit secrets; use `.env` locally and environment variables in CI: `N8N_BASE_URL`, `N8N_API_KEY` or `N8N_USERNAME`/`N8N_PASSWORD`.
- Helpful debug flags: `MCP_DEBUG=debug`, `MCP_ENABLE_SOURCE_MAPS=1`.

## Architecture Overview
- Library + CLI + MCP server. Public entrypoints: library `dist/index.js`, CLI `dist/main.js` (bin: `n8n-mcp`).
- Core responsibilities: `n8n-client` wraps n8n REST; `operations` applies workflow patch operations; CLI and MCP surface the same capabilities.
